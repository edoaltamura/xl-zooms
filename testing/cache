/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR1236.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR2272.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR2414.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR2766.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR2905.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR2915.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR3032.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR801.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR813.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR918.hdf5

[1236,2272,2414,2766,2905,2915,3032,801,813,918]

/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR1079.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR1857.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR645.hdf5


/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR121.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR130.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR139.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR155.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR187.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR18.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR23.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR340.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR36.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR37.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR470.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR485.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR55.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR666.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR680.hdf5
/cosma/home/dp004/dc-alta2/data7/xl-zooms/ics/masks/accepted/L0300N0564_VR775.hdf5

"121"
"130"
"139"
"155"
"187"
"18"
"23"
"340"
"36"
"37"
"470"
"485"
"55"
"666"
"680"
"775"

"L0300N0564_VR121_-8res_Ref"
"L0300N0564_VR1236_-8res_Ref"
"L0300N0564_VR130_-8res_Ref"
"L0300N0564_VR139_-8res_Ref"
"L0300N0564_VR155_-8res_Ref"
"L0300N0564_VR187_-8res_Ref"
"L0300N0564_VR18_-8res_Ref"
"L0300N0564_VR2272_-8res_Ref"
"L0300N0564_VR23_-8res_Ref"
"L0300N0564_VR2414_-8res_Ref"
"L0300N0564_VR2766_-8res_Ref"
"L0300N0564_VR2905_-8res_Ref"
"L0300N0564_VR2915_-8res_Ref"
"L0300N0564_VR3032_-8res_Ref"
"L0300N0564_VR340_-8res_Ref"
"L0300N0564_VR36_-8res_Ref"
"L0300N0564_VR37_-8res_Ref"
"L0300N0564_VR470_-8res_Ref"
"L0300N0564_VR485_-8res_Ref"
"L0300N0564_VR55_-8res_Ref"
"L0300N0564_VR666_-8res_Ref"
"L0300N0564_VR680_-8res_Ref"
"L0300N0564_VR775_-8res_Ref"
"L0300N0564_VR801_-8res_Ref"
"L0300N0564_VR813_-8res_Ref"
"L0300N0564_VR918_-8res_Ref"
"L0300N0564_VR93_-8res_Ref"


declare -a arr=("L0300N0564_VR121_-8res_"
"L0300N0564_VR1236_-8res_"
"L0300N0564_VR130_-8res_"
"L0300N0564_VR139_-8res_"
"L0300N0564_VR155_-8res_"
"L0300N0564_VR187_-8res_"
"L0300N0564_VR18_-8res_"
"L0300N0564_VR2272_-8res_"
"L0300N0564_VR23_-8res_"
"L0300N0564_VR2414_-8res_"
"L0300N0564_VR2766_-8res_"
"L0300N0564_VR2905_-8res_"
"L0300N0564_VR2915_-8res_"
"L0300N0564_VR3032_-8res_"
"L0300N0564_VR340_-8res_"
"L0300N0564_VR36_-8res_"
"L0300N0564_VR37_-8res_"
"L0300N0564_VR470_-8res_"
"L0300N0564_VR485_-8res_"
"L0300N0564_VR55_-8res_"
"L0300N0564_VR666_-8res_"
"L0300N0564_VR680_-8res_"
"L0300N0564_VR775_-8res_"
"L0300N0564_VR801_-8res_"
"L0300N0564_VR813_-8res_"
"L0300N0564_VR918_-8res_"
"L0300N0564_VR93_-8res_")

for i in "${arr[@]}"
do
   cp ./"$i"Ref/ics/"$i"Ref.hdf5 ./"$i"Mindist/ics/"$i"Mindist.hdf5
   cp ./"$i"Ref/ics/"$i"Ref.hdf5 ./"$i"Isotropic/ics/"$i"Isotropic.hdf5
done

for i in "${arr[@]}"
do
   cp ./run_vr.slurm $i
   cd $i
   sbatch ./run_vr.slurm
   cd ..
done


export OMP_NUM_THREADS=28
module purge
module load intel_comp/2020-update2
module load intel_mpi/2020-update2
module load ucx/1.8.1
module load parmetis/4.0.3-64bit
module load parallel_hdf5/1.10.6
module load fftw/3.3.8cosma7
module load gsl/2.5
mkdir -p stf
/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/VELOCIraptor-STF/stf \
   -i ./snapshots/L0300N0564_VR121_-8res_Ref_task_debug_2749 \
   -I 2 \
   -o ./stf/VR_redshift_0 \
   -C ../vr_config_zoom_hydro.cfg




"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR121_-8res_Ref/snapshots/L0300N0564_VR121_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR1236_-8res_Ref/snapshots/L0300N0564_VR1236_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR130_-8res_Ref/snapshots/L0300N0564_VR130_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR139_-8res_Ref/snapshots/L0300N0564_VR139_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR155_-8res_Ref/snapshots/L0300N0564_VR155_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR187_-8res_Ref/snapshots/L0300N0564_VR187_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR18_-8res_Ref/snapshots/L0300N0564_VR18_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR2272_-8res_Ref/snapshots/L0300N0564_VR2272_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR23_-8res_Ref/snapshots/L0300N0564_VR23_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR2414_-8res_Ref/snapshots/L0300N0564_VR2414_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR2766_-8res_Ref/snapshots/L0300N0564_VR2766_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR2905_-8res_Ref/snapshots/L0300N0564_VR2905_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR2915_-8res_Ref/snapshots/L0300N0564_VR2915_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR3032_-8res_Ref/snapshots/L0300N0564_VR3032_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR340_-8res_Ref/snapshots/L0300N0564_VR340_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR36_-8res_Ref/snapshots/L0300N0564_VR36_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR37_-8res_Ref/snapshots/L0300N0564_VR37_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR470_-8res_Ref/snapshots/L0300N0564_VR470_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR485_-8res_Ref/snapshots/L0300N0564_VR485_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR55_-8res_Ref/snapshots/L0300N0564_VR55_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR666_-8res_Ref/snapshots/L0300N0564_VR666_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR680_-8res_Ref/snapshots/L0300N0564_VR680_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR775_-8res_Ref/snapshots/L0300N0564_VR775_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR801_-8res_Ref/snapshots/L0300N0564_VR801_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR813_-8res_Ref/snapshots/L0300N0564_VR813_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR918_-8res_Ref/snapshots/L0300N0564_VR918_-8res_Ref_2749.hdf5",
"/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/L0300N0564_VR93_-8res_Ref/snapshots/L0300N0564_VR93_-8res_Ref_2749.hdf5",



new = {'Engine Launch (Tasks)                   ' :  29016.4311,
 'Space Rebuild                           ' : 6754.0026,
 'Engine Unskip                           ' :  5696.0435,
 'Writing Particle Properties             ' : 5297.8006,
 'Engine Drift All                        ' : 3159.6163,
 'Scheduler Reweight                      ' : 436.0456,
 'Ranking The Tasks                       ' : 377.7960,
 'Gpart Mesh Forces                       ' : 288.6281,
 'Engine Launch (Fof)                     ' : 272.8805,
 'Engine Collect End Of Step              ' :  266.3394,
 'Making Gravity Tasks                    ' : 255.4599,
 'Counting And Linking Tasks              ' : 215.9476,
 'Backwards Fourier Transform             ' : 199.1934,
 'Gpart Assignment                        ' : 192.2412,
 'Linking Gravity Tasks                   ' : 191.2098,
 'Forward Fourier Transform               ' : 186.0481,
 'Setting Unlocks                         ' : 151.5782,
 'Making Extra Hydroloop Tasks            ' : 139.8396,
 'Engine Drift Top Multipoles             ' :  106.3916,
 'Engine Split Gas Particles              ' : 89.4365,
 'Splitting Tasks                         ' : 80.3224,
 'Fof Search Tree                         ' : 69.6890,
 'Task Dump All                           ' : 68.9088,
 'Setting Super-Pointers                  ' : 60.8764,
 'Engine Marktasks                        ' : 43.0842,
 'Task Dump Stats                         ' : 29.7192,
 'Green Function                          ' : 22.7024,
 'Space List Useful Top Level Cells       ' : 19.0960,
 'Scheduler Report Task Times             ' : 13.1039,
 'Dumping Restart Files                   ' : 12.0262,
 'Engine Print Task Counts                ' : 11.4436,
 'Writing Step Info To Files              ' :  7.4365,
 'Engine Print Stats                      ' : 7.4197,
 'Engine Activate Fof Tasks               ' : 6.1570,
 'Making Hydro Tasks                      ' : 5.3769,
 'Fof Allocate                            ' : 3.1651,
 'Engine Make Fof Tasks                   ' : 1.2710,
 'Reading Initial Conditions              ' : 0.7501,
 'Space Init                              ' : 0.6152,
 'Updating General Quantities             ' :  0.4285,
 'Communicating Rebuild Flag              ' :  0.3782,
 'Engine Init                             ' : 0.0527,
 'Updating Particle Counts                ' : 0.0212,
 'Engine Recompute Displacement Constraint' : 0.0120,}


old = {'Engine Launch (Tasks)                   ' :  27687.4903,
'Space Rebuild                           ' : 6705.1026,
'Engine Unskip                           ' :  5572.7758,
'Writing Particle Properties             ' : 5446.2062,
'Engine Drift All                        ' : 3137.3981,
'Counting And Linking Tasks              ' : 717.1023,
'Scheduler Reweight                      ' : 606.7406,
'Ranking The Tasks                       ' : 558.6264,
'Splitting Tasks                         ' : 519.6988,
'Linking Gravity Tasks                   ' : 387.9255,
'Gpart Mesh Forces                       ' : 289.6065,
'Engine Collect End Of Step              ' :  262.9178,
'Making Gravity Tasks                    ' : 252.7588,
'Setting Unlocks                         ' : 251.9335,
'Engine Launch (Fof)                     ' : 243.3365,
'Backwards Fourier Transform             ' : 200.3556,
'Gpart Assignment                        ' : 192.0414,
'Forward Fourier Transform               ' : 187.1585,
'Making Extra Hydroloop Tasks            ' : 164.2226,
'Engine Drift Top Multipoles             ' :  109.8548,
'Task Dump All                           ' : 102.0122,
'Engine Split Gas Particles              ' : 89.4629,
'Fof Search Tree                         ' : 68.3748,
'Setting Super-Pointers                  ' : 61.9420,
'Task Dump Stats                         ' : 36.4361,
'Engine Marktasks                        ' : 31.0374,
'Green Function                          ' : 22.7911,
'Space List Useful Top Level Cells       ' : 18.7682,
'Writing Step Info To Files              ' :  15.9003,
'Scheduler Report Task Times             ' : 15.7096,
'Engine Print Task Counts                ' : 14.0513,
'Dumping Restart Files                   ' : 11.4881,
'Engine Print Stats                      ' : 7.5120,
'Engine Activate Fof Tasks               ' : 6.7137,
'Making Hydro Tasks                      ' : 5.2427,
'Fof Allocate                            ' : 4.0340,
'Engine Make Fof Tasks                   ' : 2.0797,
'Reading Initial Conditions              ' : 0.7351,
'Space Init                              ' : 0.6055,
'Updating General Quantities             ' :  0.4252,
'Communicating Rebuild Flag              ' :  0.3715,
'Engine Init                             ' : 0.0522,
'Updating Particle Counts                ' : 0.0213,
'Engine Recompute Displacement Constraint' : 0.0094,}

for key in old:
    print(key, new[key]-old[key])


[1236,130,139,155,187,18,2272,23,2414,2766,2905,2915,3032,340,36,37,470,485,55,666,680,775,801,813,918,93]

Objects to re-run (12)
[
"3032",
"2905",
"2414",
"1236",
"813",
"666",
"470",
"187",
"139",
"93",
"55",
"18"]

declare -a arr=("3032"
"2905"
"2414"
"1236"
"813"
"666"
"470"
"187"
"139"
"93"
"55"
"18")

declare -a arr=("470")

for i in "${arr[@]}"
do
   mkdir L0300N0564_VR"$i"_+1res_MinimumDistance/ics
   python3 /cosma/home/dp004/dc-alta2/xl-zooms/parent/combine_ics.py ../ics/ic_gen/run/ic_gen_submit_files/1LPT_8bitID/L0300N0564_VR"$i"_+1res/ICs/L0300N0564_VR"$i"_+1res.0.hdf5 L0300N0564_VR"$i"_+1res_MinimumDistance/ics/L0300N0564_VR"$i"_+1res_MinimumDistance.hdf5
   cp select_output.yml snap_redshifts.txt stf_redshifts.txt L0300N0564_VR"$i"_+1res_MinimumDistance/

   mkdir L0300N0564_VR"$i"_+1res_Isotropic/ics
   cp L0300N0564_VR"$i"_+1res_MinimumDistance/ics/L0300N0564_VR"$i"_+1res_MinimumDistance.hdf5 L0300N0564_VR"$i"_+1res_Isotropic/ics/L0300N0564_VR"$i"_+1res_Isotropic.hdf5
   cp select_output.yml snap_redshifts.txt stf_redshifts.txt L0300N0564_VR"$i"_+1res_Isotropic/
done

for i in "${arr[@]}"
do
   mkdir L0300N0564_VR"$i"_-8res_MinimumDistance/ics
   cp L0300N0564_VR"$i"_-8res_Ref/ics/L0300N0564_VR"$i"_-8res_Ref.hdf5 L0300N0564_VR"$i"_-8res_MinimumDistance/ics/L0300N0564_VR"$i"_-8res_MinimumDistance.hdf5
   cp select_output.yml snap_redshifts.txt stf_redshifts.txt L0300N0564_VR"$i"_-8res_MinimumDistance/
   mkdir L0300N0564_VR"$i"_-8res_Isotropic/ics
   cp L0300N0564_VR"$i"_-8res_Ref/ics/L0300N0564_VR"$i"_-8res_Ref.hdf5 L0300N0564_VR"$i"_-8res_Isotropic/ics/L0300N0564_VR"$i"_-8res_Isotropic.hdf5
   cp select_output.yml snap_redshifts.txt stf_redshifts.txt L0300N0564_VR"$i"_-8res_Isotropic/
done

for i in "${arr[@]}"
do
   cd L0300N0564_VR"$i"_-8res_MinimumDistance
   sbatch ./submit
   cd ..
   cd L0300N0564_VR"$i"_-8res_Isotropic
   sbatch ./submit
   cd ..
done

for i in L0300N0564_VR*_-8res_Mindist
do
   sed -i "s/./yieldtables//../yieldtables//" "$i"/params.yml
done
for t in L0300N0564_VR*_-8res_Isotropic
do
   sed -i "s/.\/yieldt/..\/yieldt/" ./"$t"/params.yml
done

for i in L0300N0564_VR*_-8res_Mindist
do
   rm "$i"/out_files/*
done
for t in L0300N0564_VR*_-8res_Isotropic
do
   rm "$i"/out_files/*
done


declare -a arr=("187"
"139"
"93")

for i in "${arr[@]}"
do
   cd L0300N0564_VR"$i"_+1res_MinimumDistance
   sbatch ./submit
   cd ..
   cd L0300N0564_VR"$i"_+1res_Isotropic
   sbatch ./submit
   cd ..
done
declare -a temps=("7.5" "8" "8.5" "9" "9.5")
declare -a arr=("VR18"
"VR23"
"VR36"
"VR37"
"VR55"
"VR93"
"VR121"
"VR130"
"VR139"
"VR155"
"VR187"
"VR340"
"VR470"
"VR485"
"VR666"
"VR680"
"VR775"
"VR801"
"VR813"
"VR918"
"VR1236"
"VR2272"
"VR2414"
"VR2766"
"VR2905"
"VR2915"
"VR3032")
for t in "${temps[@]}"
do
    for i in "${arr[@]}"
    do
        echo "$i | $t";
        cp ~/data6/xl-zooms/hydro/L0300N0564_"$i"_-8res_Ref/ics/L0300N0564_"$i"_-8res_Ref.hdf5 \
         L0300N0564_"$i"_-8res_MinimumDistance_fixedAGNdT"$t"_Nheat1_SNnobirth/ics/L0300N0564_"$i"_-8res_MinimumDistance_fixedAGNdT"$t"_Nheat1_SNnobirth.hdf5
    done
done


for i in $(ls -d L* | sort -t _ -k 2 -V | cut -d '_' -f2); do
  echo $i;
  cp ~/data6/xl-zooms/hydro/L0300N0564_"$i"_-8res_Ref/ics/L0300N0564_"$i"_-8res_Ref.hdf5 L0300N0564_"$i"_-8res_MinimumDistance_fixedAGNdT7.5_Nheat1_SNnobirth/ics/L0300N0564_"$i"_-8res_MinimumDistance_fixedAGNdT7.5_Nheat1_SNnobirth; done


for i in L0300N0564_VR*_Nheat1_SNnobirth
do
    mkdir "_$i"
    mv $i/snapshots "_$i/"
    mv $i/stf "_$i/"
    mv $i/timesteps_28.txt "_$i/"
    mkdir "_$i/out_files"
    mv $i/out_files/* "_$i/out_files/"
    mv $i/statistics.txt "_$i/"
done

for i in L0300N0564_VR*_-8res_MinimumDistance_fixedAGNdT9.5_Nheat1_SNnobirth
do
    rm $i/dependency_graph_0.csv
    rm $i/task_level_0.txt
    rm $i/used_parameters.yml
    rm $i/unused_parameters.yml
    rm $i/SFR.txt
done

for i in L0300N0564_VR*_-8res_MinimumDistance_fixedAGNdT7.5_Nheat1_SNnobirth
do
    sed -i "s/AGN_delta_T_K:                      3.16228e9/AGN_delta_T_K:                      3.16228e7/" $i/params.yml
done

for i in L0300N0564_VR*_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth
do
    sed -i "s/AGN_delta_T_K:                      3.16228e9/AGN_delta_T_K:                      1.e9/" $i/params.yml
done


for i in L0300N0564_VR*_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth
do
    mv -rf _$i
done

declare -a arr=("18"
"37"
"139"
"485"
"680"
"813"
"1236"
"2414"
"2915")

for t in "${arr[@]}"
do
    echo $t
    rm -rf L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth
    mkdir L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth
    mkdir L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/out_files
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/snap_redshifts.txt L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/select_output.yml L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/stf_redshifts.txt L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/auto_resubmit L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/submit L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/resubmit L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/params.yml L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth

    chmod 744 L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/submit
    chmod 744 L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/resubmit
    chmod 744 L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/auto_resubmit

    sed -i "s/_-8res_/_+1res_/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/submit
    sed -i "s/_-8res_/_+1res_/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/resubmit
    sed -i "s/_-8res_/_+1res_/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/params.yml

    sed -i "s/particle_splitting_mass_threshold: 0.00586782/particle_splitting_mass_threshold: 0.00073348/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/params.yml

    sed -i "s/file_name:  .\/ics\/L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth.hdf5/file_name:  \/cosma7\/data\/dp004\/dc-alta2\/xl-zooms\/ics\/ic_gen\/run\/ic_gen_submit_files\/1LPT_8bitID\/L0300N0564_VR"$t"_+1res\/L0300N0564_VR"$t"_+1res.hdf5/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/params.yml

    sed -i "s/0.00665484 # Comoving softening for DM/0.00332742 # Comoving softening for DM/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/params.yml
    sed -i "s/0.00380430 # Comoving softening for baryons/0.00190215 # Comoving softening for baryons/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/params.yml
    sed -i "s/0.00295770 # Physical softening for DM/0.00147885 # Physical softening for DM/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/params.yml
    sed -i "s/0.00169080 # Physical softening for baryons/0.00084540 # Physical softening for baryons/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/params.yml

done


for i in L0300N0564_VR*_-8res
do
    echo $i
    python3 /cosma/home/dp004/dc-alta2/xl-zooms/parent/combine_ics.py ./"$i"/ICs/"$i".0.hdf5 ./"$i"/"$i".hdf5
done



for t in "${arr[@]}"
do
    echo $t
    chmod 744 L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/submit
    chmod 744 L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/resubmit
    chmod 744 L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/auto_resubmit

    cd L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth
    sbatch submit
    cd ..
done



declare -a arr=("18"
"23"
"36"
"37"
"55"
"93"
"121"
"130"
"139"
"155"
"187"
"340"
"470"
"485"
"666"
"680"
"775"
"801"
"813"
"918"
"1236"
"2272"
"2414"
"2766"
"2905"
"2915"
"3032")

for t in "${arr[@]}"
do
    echo $t
    rm -rf L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth
    mkdir L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth
    mkdir L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth/out_files
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/snap_redshifts.txt L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/select_output.yml L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/stf_redshifts.txt L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/auto_resubmit L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/submit L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/resubmit L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/params.yml L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth

    chmod 744 L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth/submit
    chmod 744 L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth/resubmit
    chmod 744 L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth/auto_resubmit

    sed -i "s/MinimumDistance/Isotropic/" L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth/submit
    sed -i "s/MinimumDistance/Isotropic/" L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth/resubmit
    sed -i "s/MinimumDistance/Isotropic/" L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth/params.yml

    sed -i "s/file_name:  .\/ics\/L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth.hdf5/file_name:  \/cosma7\/data\/dp004\/dc-alta2\/xl-zooms\/ics\/ic_gen\/run\/ic_gen_submit_files\/1LPT_8bitID\/L0300N0564_VR"$t"_-8res\/L0300N0564_VR"$t"_-8res.hdf5/" L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth/params.yml

    cd L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth
    sbatch submit
    cd ..
done

for t in "${arr[@]}"
do
    echo $t
    rm -rf L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    mkdir L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    mkdir L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/out_files
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/snap_redshifts.txt L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/select_output.yml L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/stf_redshifts.txt L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/auto_resubmit L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/submit L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/resubmit L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth/params.yml L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth

    chmod 744 L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/submit
    chmod 744 L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/resubmit
    chmod 744 L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/auto_resubmit

    sed -i "s/MinimumDistance/Isotropic/" L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/submit
    sed -i "s/MinimumDistance/Isotropic/" L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/resubmit
    sed -i "s/MinimumDistance/Isotropic/" L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/params.yml

    sed -i "s/file_name:  .\/ics\/L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth.hdf5/file_name:  \/cosma7\/data\/dp004\/dc-alta2\/xl-zooms\/ics\/ic_gen\/run\/ic_gen_submit_files\/1LPT_8bitID\/L0300N0564_VR"$t"_-8res\/L0300N0564_VR"$t"_-8res.hdf5/" L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/params.yml

done


declare -a arr=("18"
"37"
"139"
"485"
"680"
"813"
"1236"
"2414"
"2915")

for t in "${arr[@]}"
do
    echo $t
    rm -rf L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    mkdir L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    mkdir L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/out_files
    cp L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/snap_redshifts.txt L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/select_output.yml L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/stf_redshifts.txt L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/auto_resubmit L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/submit L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/resubmit L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/params.yml L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth

    chmod 744 L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/submit
    chmod 744 L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/resubmit
    chmod 744 L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/auto_resubmit

    sed -i "s/_-8res_/_+1res_/" L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/submit
    sed -i "s/_-8res_/_+1res_/" L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/resubmit
    sed -i "s/_-8res_/_+1res_/" L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/params.yml

    sed -i "s/particle_splitting_mass_threshold: 0.00586782/particle_splitting_mass_threshold: 0.00073348/" L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/params.yml

    sed -i "s/0.00665484 # Comoving softening for DM/0.00332742 # Comoving softening for DM/" L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/params.yml
    sed -i "s/0.00380430 # Comoving softening for baryons/0.00190215 # Comoving softening for baryons/" L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/params.yml
    sed -i "s/0.00295770 # Physical softening for DM/0.00147885 # Physical softening for DM/" L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/params.yml
    sed -i "s/0.00169080 # Physical softening for baryons/0.00084540 # Physical softening for baryons/" L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth/params.yml

done

declare -a arr=("18"
"37"
"139"
"485"
"680"
"813"
"1236"
"2414"
"2915")

for t in "${arr[@]}"
do
    echo $t
    rm -rf L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth
    mkdir L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth
    mkdir L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/out_files
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/snap_redshifts.txt L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/select_output.yml L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/stf_redshifts.txt L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/auto_resubmit L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/submit L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/resubmit L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth
    cp L0300N0564_VR"$t"_-8res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/params.yml L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth

    chmod 744 L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/submit
    chmod 744 L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/resubmit
    chmod 744 L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/auto_resubmit

    sed -i "s/_-8res/_+1res/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/submit
    sed -i "s/_-8res/_+1res/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/resubmit
    sed -i "s/_-8res/_+1res/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/params.yml

    sed -i "s/particle_splitting_mass_threshold: 0.00586782/particle_splitting_mass_threshold: 0.00073348/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/params.yml

    sed -i "s/0.00665484 # Comoving softening for DM/0.00332742 # Comoving softening for DM/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/params.yml
    sed -i "s/0.00380430 # Comoving softening for baryons/0.00190215 # Comoving softening for baryons/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/params.yml
    sed -i "s/0.00295770 # Physical softening for DM/0.00147885 # Physical softening for DM/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/params.yml
    sed -i "s/0.00169080 # Physical softening for baryons/0.00084540 # Physical softening for baryons/" L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth/params.yml

    cd L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth
    sbatch submit
    cd ..

done


declare -a arr=("18"
"37"
"139"
"485"
"680"
"813"
"1236"
"2414"
"2915")

for t in "${arr[@]}"
do
    echo L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8.5_Nheat1_SNnobirth

    if [ -d L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8.5_Nheat1_SNnobirth/stf ]; then
        if [ -z "$(ls -A L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8.5_Nheat1_SNnobirth/stf)" ]; then
           echo "stf directory exists and is empty"
        else
           echo "stf directory exists and is not empty"
        fi
    fi

    if tail L0300N0564_VR"$t"_+1res_MinimumDistance_fixedAGNdT8.5_Nheat1_SNnobirth/timesteps*.txt | grep 1.0000000 -q; then
        echo "Simulation reached redshift 0."
    fi
    echo Done
done


declare -a arr=("18"
"37"
"139"
"485"
"680"
"813"
"1236"
"2414"
"2915")

for t in "${arr[@]}"
do
    echo $t
    sed -i "s/_-8res/_+1res/" L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth/params.yml
    grep "/cosma" L0300N0564_VR"$t"_+1res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth/params.yml
done

for i in {15..36}
do
   python3 temperature_density.py -k VR18_-8res_MinimumDistance_fixedAGNdT8.5_ -m true -r $i -a 100 -q
done

ffmpeg \
    -framerate 2 \
    -start_number 20 \
    -i subgrid_density_temperature_%04d.png \
    -vf scale=-2:1080,format=yuv420p \
    -c:v libx264 \
    -profile:v high \
    -c:a aac \
    -strict experimental \
    -b:a 192k \
    -movflags faststart \
    -crf 16 \
    density_temperature_VR18_-8res_MinimumDistance_fixedAGNdT8p5.mp4


ffmpeg \
    -framerate 2 \
    -start_number 15 \
    -i subgrid_density_temperature_%04d.png \
    -vf scale=-2:1080,format=yuv420p \
    density_temperature_VR18_-8res_MinimumDistance_fixedAGNdT8p5.mp4

declare -a arr=(
"L0300N0564_VR18_-8res_MinimumDistance_fixedAGNdT8.5_Nheat1_alpha0p5"
"L0300N0564_VR18_-8res_MinimumDistance_fixedAGNdT8.5_Nheat1_alpha0p0"
"L0300N0564_VR18_-8res_MinimumDistance_fixedAGNdT8.5_Nheat1_alpha1p0"
"L0300N0564_VR18_-8res_MinimumDistance_fixedAGNdT8.5_Nheat1_alpha0p7"
"L0300N0564_VR18_-8res_MinimumDistance_fixedAGNdT8.5_Nheat1_alpha0p9"
)

for i in "${arr[@]}"
do
    echo $i
    cp run_vr.slurm $i
    cd $i
    sed -i "s/VR-zoom/VR-"$i"/" run_vr.slurm
    sbatch run_vr.slurm
    cd ..
done

declare -a arr=(
"L0300N0564_VR18_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth"
"L0300N0564_VR18_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth"
"L0300N0564_VR18_+1res_Isotropic_fixedAGNdT8.5_Nheat1_SNnobirth"
"L0300N0564_VR18_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth"
"L0300N0564_VR37_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth"
"L0300N0564_VR18_+1res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth"
"L0300N0564_VR18_+1res_MinimumDistance_fixedAGNdT8.5_Nheat1_SNnobirth"
"L0300N0564_VR37_+1res_Isotropic_fixedAGNdT8_Nheat1_SNnobirth"
"L0300N0564_VR37_+1res_Isotropic_fixedAGNdT8.5_Nheat1_SNnobirth"
"L0300N0564_VR37_+1res_Isotropic_fixedAGNdT9_Nheat1_SNnobirth"
"L0300N0564_VR37_+1res_MinimumDistance_fixedAGNdT8_Nheat1_SNnobirth"
"L0300N0564_VR37_+1res_MinimumDistance_fixedAGNdT8.5_Nheat1_SNnobirth"
"L0300N0564_VR139_+1res_MinimumDistance_fixedAGNdT9_Nheat1_SNnobirth"
)

for i in "${arr[@]}"
do
    echo $i
    cd $i
    sbatch resubmit
    cd ..
done

module purge
module load cmake/3.18.1
module load intel_comp/2020-update2
module load intel_mpi/2020-update2
module load ucx/1.8.1
module load parmetis/4.0.3-64bit
module load parallel_hdf5/1.10.6
module load fftw/3.3.8cosma7
module load gsl/2.5
export OMP_NUM_THREADS=28

/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/VELOCIraptor-STF/stf \
    -I 2 \
    -C vrconfig_3dfofbound_subhalos_SO_hydro_adiabatic.cfg \
    -i L0300N0564_VR18_-8res_MinimumDistance_fixedAGNdT8.5_Nheat1_alpha0p0_adiabatic/snapshots/L0300N0564_VR18_-8res_MinimumDistance_fixedAGNdT8.5_Nheat1_SNnobirth_2522 \
    -o vr_partial_outputs/alpha0p0_adi

/cosma7/data/dp004/dc-alta2/xl-zooms/hydro/VELOCIraptor-STF/stf \
    -I 2 \
    -C vrconfig_3dfofbound_subhalos_SO_hydro_adiabatic.cfg \
    -i L0300N0564_VR18_-8res_MinimumDistance_fixedAGNdT8.5_Nheat1_alpha1p0_adiabatic/snapshots/L0300N0564_VR18_-8res_MinimumDistance_fixedAGNdT8.5_Nheat1_SNnobirth_2522 \
    -o vr_partial_outputs/alpha1p0_adi

cmake . \
    -DVR_USE_HYDRO=ON \
    -DVR_USE_GAS=ON \
    -DVR_USE_STAR=OFF \
    -DVR_USE_BH=OFF \
    -DVR_USE_SWIFT_INTERFACE=OFF \
    -DCMAKE_CXX_FLAGS="-fPIC" \
    -DCMAKE_BUILD_TYPE=Release \
    -DVR_ZOOM_SIM=ON \
    -DVR_MPI=OFF











































