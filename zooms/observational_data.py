import numpy as np
from astropy import cosmology
import pandas as pd
from unyt import Solar_Mass


class Observations:

    def __init__(self, cosmo_model: str = "Planck18"):

        for model_name in dir(cosmology):
            if cosmo_model.lower() in model_name.lower():
                print(f"Using the {model_name} cosmology")
                self.cosmo_model = getattr(cosmology, model_name)


class Sun09(Observations):
    paper_name = "Sun et al. (2009)"
    notes = "Data in h_73 units."

    M500_Sun = np.array(
        [3.18, 4.85, 3.90, 1.48, 4.85, 5.28, 8.49, 10.3,
         2.0, 7.9, 5.6, 12.9, 8.0, 14.1, 3.22, 14.9, 13.4,
         6.9, 8.95, 8.8, 8.3, 9.7, 7.9]
    ) * 1.e13 * Solar_Mass
    f500_Sun = np.array(
        [0.097, 0.086, 0.068, 0.049, 0.069, 0.060, 0.076,
         0.081, 0.108, 0.086, 0.056, 0.076, 0.075, 0.114,
         0.074, 0.088, 0.094, 0.094, 0.078, 0.099, 0.065,
         0.090, 0.093]
    )
    Mgas500_Sun = M500_Sun * f500_Sun

    def __init__(self, *args, **kwargs):
        super(Sun09, self).__init__(*args, **kwargs)

        h70_Sun = 0.73 / self.cosmo_model.h
        self.M500 = self.M500_Sun * h70_Sun
        self.Mgas500 = self.Mgas500_Sun * (h70_Sun ** 2.5)


class Lovisari15(Observations):
    paper_name = "Lovisari et al. (2015)"
    notes = "Data in h_70 units."

    M500_Lov = np.array(
        [2.07, 4.67, 2.39, 2.22, 2.95, 2.83, 3.31, 3.53, 3.49,
         3.35, 14.4, 2.34, 4.78, 8.59, 9.51, 6.96, 10.8, 4.37,
         8.00, 12.1]
    ) * 1.e13 * Solar_Mass
    Mgas500_Lov = np.array(
        [0.169, 0.353, 0.201, 0.171, 0.135, 0.272, 0.171,
         0.271, 0.306, 0.247, 1.15, 0.169, 0.379, 0.634,
         0.906, 0.534, 0.650, 0.194, 0.627, 0.817]
    ) * 1.e13 * Solar_Mass

    def __init__(self, *args, **kwargs):
        super(Lovisari15, self).__init__(*args, **kwargs)

        h70_Lov = 0.70 / self.cosmo_model.h
        self.M500 = self.M500_Lov * h70_Lov
        self.Mgas500 = self.Mgas500_Lov * (h70_Lov ** 2.5)


class Kravtsov18(Observations):
    paper_name = "Kravtsov et al. (2018)"
    notes = "Data in h_70 units."

    M500_Kra = np.array(
        [15.60, 10.30, 7.00, 5.34, 2.35, 1.86, 1.34, 0.46, 0.47]
    ) * 10. * 1.e13 * Solar_Mass
    Mstar500_Kra = np.array(
        [15.34, 12.35, 8.34, 5.48, 2.68, 3.48, 2.86, 1.88, 1.85]
    ) * 0.1 * 1.e13 * Solar_Mass

    def __init__(self, *args, **kwargs):
        super(Kravtsov18, self).__init__(*args, **kwargs)

        h70_Kra = 0.70 / self.cosmo_model.h
        self.M500 = self.M500_Kra * h70_Kra
        self.Mstar500 = self.Mstar500_Kra * (h70_Kra ** 2.5)


class Budzynski14(Observations):
    paper_name = "Budzynski et al. (2014)"
    notes = "Data in h_70 units."

    M500_Bud = np.array([10 ** 13.7, 10 ** 15]) * Solar_Mass
    Mstar500_Bud = 10. ** (0.89 * np.log10(M500_Bud / 3.e14) + 12.44) * Solar_Mass

    # Mstar−M500 relation
    # a = 0.89 ± 0.14 and b = 12.44 ± 0.03
    #
    # $\log \left(\frac{M_{\text {star }}}{\mathrm{M}_{\odot}}\right)=a \log \left(\frac{M_{500}}
    # {3 \times 10^{14} \mathrm{M}_{\odot}}\right)+b$

    # star−M500 relation
    # alpha = −0.11 ± 0.14 and beta = −2.04 ± 0.03
    #
    # $\log f_{\text {star }}=\alpha \log \left(\frac{M_{500}}{3 \times 10^{14} \mathrm{M}_{\odot}}\right)+\beta$

    def __init__(self, *args, **kwargs):
        super(Budzynski14, self).__init__(*args, **kwargs)

        h70_Bud = 0.70 / self.cosmo_model.h
        self.M500 = self.M500_Bud * h70_Bud
        self.Mstar500 = self.Mstar500_Bud * (h70_Bud ** 2.5)


class Gonzalez13(Observations):
    pass


class Barnes17(Observations):
    paper_name = "Barnes et al. (2017)"
    notes = "Assumes Planck14."

    field_names = [
        "Cluster name", "log10(M_500true)", "log10(M_500hse)", "log10(M_500spec)", "r_500true (Mpc)", "r_500spec (Mpc)",
        "IC location x (Mpc/h)", "IC location y (Mpc/h)", "IC location z (Mpc/h)", "IC extent (Mpc/h)", "k_B T_X (keV)",
        "L_X^{0.5−2.0 keV} (log10(L/erg s−1))", "M_gas <r_500spec (log10(M/M))", "M_star <r_500spec (log10(M/M))",
        "Y_X <r_500spec (log10(Y/MkeV))", "Y_SZ <5*r_500spec (log10(Y/Mpc2))", "Z_Fe (Z_FeSun)", "E_kin/E_thrm"
    ]

    table_Barn = [
        "CE-00, 13.905, 13.756, 13.751, 0.65, 0.58, 207.81, 1498.48, 1793.66, 22.45, 1.81, 43.234, 12.881, 12.230, 13.125, −5.445, 0.26, 0.11",
        "CE-01, 13.982, 13.927, 13.931, 0.69, 0.66, 1765.99, 1721.52, 1541.50, 21.03, 2.18, 43.459, 13.026, 12.290, 13.302, −5.521, 0.21, 0.24",
        "CE-02, 13.920, 13.870, 13.871, 0.66, 0.63, 1962.55, 1953.81, 234.28, 21.03, 1.90, 43.227, 12.954, 12.164, 13.217, −5.425, 0.27, 0.05",
        "CE-03, 13.926, 13.877, 13.861, 0.66, 0.63, 1772.74, 1915.43, 616.81, 27.33, 2.01, 43.114, 12.924, 12.140, 13.221, −5.298, 0.21, 0.06",
        "CE-04, 13.853, 13.723, 13.697, 0.62, 0.55, 1170.49, 1524.83, 1807.16, 23.97, 1.79, 42.888, 12.789, 11.994, 13.027, −5.449, 0.22, 0.11",
        "CE-05, 13.892, 13.902, 13.880, 0.64, 0.64, 395.90, 613.11, 1126.81, 23.97, 1.75, 43.240, 12.970, 12.154, 13.213, −5.340, 0.29, 0.09",
        "CE-06, 14.128, 14.102, 14.083, 0.77, 0.74, 1774.60, 1519.13, 206.88, 35.53, 2.28, 43.518, 13.204, 12.306, 13.551, −5.046, 0.22, 0.09",
        "CE-07, 14.176, 14.127, 14.121, 0.80, 0.77, 856.66, 1662.35, 869.10, 31.16, 2.48, 43.657, 13.247, 12.354, 13.631, −4.984, 0.21, 0.09",
        "CE-08, 14.070, 13.980, 13.941, 0.74, 0.67, 329.85, 497.42, 247.39, 24.63, 2.03, 43.518, 13.120, 12.247, 13.412, −5.126, 0.25, 0.09",
        "CE-09, 14.244, 14.118, 14.084, 0.84, 0.74, 922.84, 982.93, 1499.01, 24.77, 2.60, 43.620, 13.237, 12.434, 13.641, −4.850, 0.20, 0.16",
        "CE-10, 14.301, 14.250, 14.225, 0.88, 0.83, 1771.02, 1093.98, 1271.48, 25.60, 3.00, 43.890, 13.414, 12.479, 13.886, −4.758, 0.26, 0.05",
        "CE-11, 14.290, 14.182, 14.182, 0.87, 0.80, 1740.71, 459.04, 920.32, 26.45, 2.66, 44.080, 13.389, 12.482, 13.815, −4.845, 0.29, 0.21",
        "CE-12, 14.422, 14.349, 14.326, 0.96, 0.90, 793.25, 945.74, 682.99, 36.72, 3.28, 43.942, 13.485, 12.644, 13.990, −4.636, 0.26, 0.08",
        "CE-13, 14.341, 14.249, 14.266, 0.91, 0.86, 682.60, 1023.43, 1327.07, 32.20, 3.20, 44.117, 13.443, 12.460, 13.917, −4.721, 0.29, 0.06",
        "CE-14, 14.563, 14.571, 14.568, 1.08, 1.08, 184.91, 991.14, 1381.74, 49.32, 3.99, 44.321, 13.704, 12.709, 14.302, −4.508, 0.23, 0.31",
        "CE-15, 14.407, 14.404, 14.418, 0.95, 0.96, 1364.14, 501.66, 1179.09, 41.86, 3.56, 44.037, 13.511, 12.592, 13.993, −4.608, 0.16, 0.22",
        "CE-16, 14.311, 14.170, 14.143, 0.89, 0.78, 487.63, 1526.81, 406.49, 41.86, 3.06, 43.877, 13.351, 12.505, 13.814, −4.522, 0.26, 0.12",
        "CE-17, 14.537, 14.461, 14.433, 1.05, 0.97, 143.61, 1251.36, 1953.15, 31.16, 3.91, 44.284, 13.623, 12.684, 14.208, −4.525, 0.21, 0.25",
        "CE-18, 14.639, 14.587, 14.555, 1.14, 1.07, 542.69, 580.55, 1091.34, 41.86, 4.22, 44.402, 13.744, 12.787, 14.359, −4.262, 0.19, 0.09",
        "CE-19, 14.586, 14.483, 14.445, 1.09, 0.98, 547.19, 219.86, 760.69, 37.94, 3.23, 44.102, 13.660, 12.723, 14.171, −4.354, 0.25, 0.30",
        "CE-20, 14.482, 14.361, 14.342, 1.01, 0.91, 1827.41, 1204.77, 2009.96, 30.16, 3.60, 44.127, 13.551, 12.660, 14.077, −4.457, 0.24, 0.12",
        "CE-21, 14.800, 15.012, 14.934, 1.29, 1.43, 767.31, 607.95, 650.43, 40.51, 5.09, 44.540, 13.990, 13.024, 14.694, −4.009, 0.51, 0.29",
        "CE-22, 14.837, 14.721, 14.701, 1.33, 1.20, 1407.02, 1572.74, 567.84, 62.05, 6.04, 44.618, 13.937, 12.967, 14.668, −3.854, 0.16, 0.12",
        "CE-23, 14.426, 14.291, 14.256, 0.97, 0.85, 1378.96, 2033.10, 1838.00, 37.94, 3.16, 43.904, 13.452, 12.642, 13.934, −4.325, 0.19, 0.26",
        "CE-24, 14.821, 14.728, 14.666, 1.31, 1.16, 209.13, 668.70, 1948.65, 52.66, 5.31, 44.412, 13.876, 12.937, 14.598, −4.005, 0.17, 0.13",
        "CE-25, 15.045, 15.070, 15.068, 1.56, 1.58, 697.69, 861.16, 860.76, 49.32, 7.95, 45.021, 14.214, 13.177, 15.102, −3.650, 0.23, 0.31",
        "CE-26, 14.899, 14.838, 14.780, 1.39, 1.27, 1907.88, 852.55, 1346.40, 43.26, 6.43, 44.589, 14.010, 13.037, 14.809, −3.765, 0.19, 0.08",
        "CE-27, 14.689, 14.496, 14.389, 1.18, 0.94, 1790.48, 618.80, 1783.99, 41.86, 5.28, 42.987, 13.094, 12.323, 13.811, −4.259, 0.19, 0.24",
        "CE-28, 14.902, 14.688, 14.671, 1.39, 1.17, 944.94, 707.08, 1388.09, 62.05, 6.29, 44.407, 13.906, 13.051, 14.697, −3.735, 0.18, 0.13",
        "CE-29, 15.077, 15.089, 14.912, 1.60, 1.40, 719.79, 1449.38, 1015.75, 60.04, 7.66, 44.942, 14.188, 13.185, 15.067, −3.510, 0.52, 0.30"
    ]

    def __init__(self, *args, **kwargs):
        super(Barnes17, self).__init__(*args, **kwargs)
        self.process_data()
        h70_Barn = 0.6777 / self.cosmo_model.h

    def process_data(self):
        table_series = pd.Series(self.table_Barn).str.split(', ')
        table_series = np.array(table_series.values.tolist())
        print(table_series.shape)
        df = pd.DataFrame(table_series, columns=self.field_names)
        print(df)


bud14 = Barnes17()
# print(bud14.Mstar500, bud14.M500)
